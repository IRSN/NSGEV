<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TVGEV: Check Venice Example • NSGEV</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="TVGEV: Check Venice Example">
<meta property="og:description" content="NSGEV">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">NSGEV</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/IntroTVGEV.html">Time-Varying Models in NSGEV</a>
    </li>
    <li>
      <a href="../articles/NSGEV_Val.html">TVGEV: Checks</a>
    </li>
    <li>
      <a href="../articles/NSRL.html">TVGEV: Check Return Levels</a>
    </li>
    <li>
      <a href="../articles/ProfLik.html">TVGEV: Check Profile Likelihood</a>
    </li>
    <li>
      <a href="../articles/Venice.html">TVGEV: Check Venice Example</a>
    </li>
    <li>
      <a href="../articles/simulatedBreaks.html">TVGEV: Check Simulated Trend</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/IRSN/NSGEV/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>TVGEV: Check Venice Example</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/IRSN/NSGEV/blob/HEAD/vignettes/Venice.Rmd" class="external-link"><code>vignettes/Venice.Rmd</code></a></small>
      <div class="hidden name"><code>Venice.Rmd</code></div>

    </div>

    
    
<div class="section level3">
<h3 id="venice-example-and-data">Venice example and data<a class="anchor" aria-label="anchor" href="#venice-example-and-data"></a>
</h3>
<p>This example was studied by Coles and <a href="http://www.mas.ncl.ac.uk/~nlf8/teaching/mas8391/background/chapter5.pdf" class="external-link">Fawcett</a>
who both fitted time varying GEV models with linear and quadratic trend
by using the <strong>ismev</strong> package. We reproduce here their
results by using <strong>NSGEV</strong> and also
<strong>extRemes</strong>.</p>
<p>Although the data contains the <span class="math inline">\(r\)</span>-largest observations, we use only the
annual maxima here; These are found in column 2 of the matrix
object.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">venice</span>, package <span class="op">=</span> <span class="st">"ismev"</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Year <span class="op">=</span> <span class="va">venice</span><span class="op">[</span> , <span class="fl">1</span><span class="op">]</span>,</span>
<span>                 date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span> <span class="st">"%4d-01-01"</span>, <span class="va">venice</span><span class="op">[</span> , <span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                 SeaLevel <span class="op">=</span> <span class="va">venice</span><span class="op">[</span> , <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">within</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%4d-01-01"</span>, <span class="va">Year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">SeaLevel</span> <span class="op">~</span> <span class="va">date</span>, data <span class="op">=</span> <span class="va">df</span>, type <span class="op">=</span> <span class="st">"o"</span>, pch <span class="op">=</span> <span class="fl">16</span>, xlab <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<p><img src="Rgraphics/venice1-1.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="fitting-stationary-gev-models">Fitting stationary GEV models<a class="anchor" aria-label="anchor" href="#fitting-stationary-gev-models"></a>
</h3>
<p>We begin by fitting a stationary GEV model.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">estim</span> <span class="op">&lt;-</span> <span class="st">"optim"</span></span>
<span><span class="va">fitTVGEV0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TVGEV.html">TVGEV</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span>,</span>
<span>                   response <span class="op">=</span> <span class="st">"SeaLevel"</span>, date <span class="op">=</span> <span class="st">"date"</span>,</span>
<span>                   estim <span class="op">=</span> <span class="va">estim</span>,</span>
<span>                   loc <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">fitismev0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ismev/man/gev.fit.html" class="external-link">gev.fit</a></span><span class="op">(</span>xdat <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">SeaLev</span><span class="op">)</span></span>
<span><span class="va">fitextRemes0</span> <span class="op">&lt;-</span> <span class="fu">extRemes</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/extRemes/man/fevd.html" class="external-link">fevd</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">SeaLev</span>, type <span class="op">=</span> <span class="st">"GEV"</span><span class="op">)</span></span></code></pre></div>
<p>The estimated coefficients and maximised log-likelihoods are as
follows.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="st">"NSGEV"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fitTVGEV0</span><span class="op">)</span>,</span>
<span>      <span class="st">"ismev"</span> <span class="op">=</span> <span class="va">fitismev0</span><span class="op">$</span><span class="va">mle</span>,</span>
<span>      <span class="st">"extRemes"</span> <span class="op">=</span> <span class="va">fitextRemes0</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">par</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##              mu_0  sigma_0        xi_0</span></span>
<span><span class="co">## NSGEV    111.0982 17.17421 -0.07672147</span></span>
<span><span class="co">## ismev    111.0993 17.17549 -0.07673265</span></span>
<span><span class="co">## extRemes 111.0973 17.17910 -0.07678211</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NSGEV"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">fitTVGEV0</span><span class="op">)</span>,</span>
<span>  <span class="st">"ismev"</span> <span class="op">=</span> <span class="op">-</span><span class="va">fitismev0</span><span class="op">$</span><span class="va">nllh</span>,</span>
<span>  <span class="st">"extRemes"</span> <span class="op">=</span> <span class="op">-</span><span class="va">fitextRemes0</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">value</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     NSGEV     ismev  extRemes </span></span>
<span><span class="co">## -222.7145 -222.7145 -222.7145</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="linear-trend">Linear trend<a class="anchor" aria-label="anchor" href="#linear-trend"></a>
</h3>
<p>We now introduce a linear trend. We first create a dataframe to be
used with the functions from <strong>extRemes</strong> and
<strong>ismev</strong>, with a linear and variable a quadratic trend
variable as well.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfismev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">within</a></span><span class="op">(</span><span class="va">df</span>, <span class="op">{</span><span class="va">t1num</span> <span class="op">&lt;-</span> <span class="va">Year</span> <span class="op">-</span> <span class="fl">1930</span>; <span class="va">t2num</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">Year</span> <span class="op">-</span> <span class="fl">1930</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">}</span><span class="op">)</span></span>
<span><span class="va">fitTVGEV1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TVGEV.html">TVGEV</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span>,</span>
<span>                   response <span class="op">=</span> <span class="st">"SeaLevel"</span>, date <span class="op">=</span> <span class="st">"date"</span>,</span>
<span>                   design <span class="op">=</span> <span class="fu"><a href="../reference/polynomX.html">polynomX</a></span><span class="op">(</span>date <span class="op">=</span> <span class="va">date</span>,</span>
<span>                       degree <span class="op">=</span> <span class="fl">2</span>, origin <span class="op">=</span> <span class="st">"1930-01-01"</span><span class="op">)</span>,</span>
<span>                   estim <span class="op">=</span> <span class="va">estim</span>,</span>
<span>                   trace <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                   loc <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">t1</span><span class="op">)</span></span>
<span><span class="va">fitismev1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ismev/man/gev.fit.html" class="external-link">gev.fit</a></span><span class="op">(</span>xdat <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">SeaLev</span>,</span>
<span>                     ydat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">dfismev</span><span class="op">[</span> , <span class="st">"t1num"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                     mul <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">fitextRemes1</span> <span class="op">&lt;-</span> <span class="fu">extRemes</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/extRemes/man/fevd.html" class="external-link">fevd</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dfismev</span><span class="op">$</span><span class="va">SeaLev</span>,</span>
<span>                               data <span class="op">=</span> <span class="va">dfismev</span>,</span>
<span>                               type <span class="op">=</span> <span class="st">"GEV"</span>,</span>
<span>                               location.fun <span class="op">=</span> <span class="op">~</span><span class="va">t1num</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="st">"NSGEV"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fitTVGEV1</span><span class="op">)</span>,</span>
<span>      <span class="st">"ismev"</span> <span class="op">=</span> <span class="va">fitismev1</span><span class="op">$</span><span class="va">mle</span>,</span>
<span>      <span class="st">"extRemes"</span> <span class="op">=</span> <span class="va">fitextRemes1</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">par</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##              mu_0     mu_t1  sigma_0        xi_0</span></span>
<span><span class="co">## NSGEV    96.97787 0.5645199 14.58559 -0.02750053</span></span>
<span><span class="co">## ismev    96.98579 0.5641427 14.58435 -0.02731421</span></span>
<span><span class="co">## extRemes 96.96317 0.5648220 14.58120 -0.02731842</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NSGEV"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">fitTVGEV1</span><span class="op">)</span>,</span>
<span>  <span class="st">"ismev"</span> <span class="op">=</span> <span class="op">-</span><span class="va">fitismev1</span><span class="op">$</span><span class="va">nllh</span>,</span>
<span>  <span class="st">"extRemes"</span> <span class="op">=</span> <span class="op">-</span><span class="va">fitextRemes1</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">value</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     NSGEV     ismev  extRemes </span></span>
<span><span class="co">## -216.0625 -216.0626 -216.0626</span></span></code></pre>
<p>We can perform a likelihood-ratio test as in the references.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">fitTVGEV0</span>, <span class="va">fitTVGEV1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Analysis of Deviance Table</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##           df deviance      W    Pr(&gt;W)    </span></span>
<span><span class="co">## fitTVGEV0  3   445.43                     </span></span>
<span><span class="co">## fitTVGEV1  4   432.13 13.304 0.0002648 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="quadratic-trend">Quadratic trend<a class="anchor" aria-label="anchor" href="#quadratic-trend"></a>
</h3>
<p>We now add a quadratic term in the trend.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fitTVGEV2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TVGEV.html">TVGEV</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span>,</span>
<span>                   response <span class="op">=</span> <span class="st">"SeaLevel"</span>, date <span class="op">=</span> <span class="st">"date"</span>,</span>
<span>                   design <span class="op">=</span> <span class="fu"><a href="../reference/polynomX.html">polynomX</a></span><span class="op">(</span>date <span class="op">=</span> <span class="va">date</span>,</span>
<span>                       degree <span class="op">=</span> <span class="fl">2</span>, origin <span class="op">=</span> <span class="st">"1930-01-01"</span><span class="op">)</span>,</span>
<span>                   estim <span class="op">=</span> <span class="va">estim</span>,</span>
<span>                   trace <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                   loc <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">t1</span> <span class="op">+</span> <span class="va">t2</span><span class="op">)</span></span>
<span><span class="va">fitismev2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ismev/man/gev.fit.html" class="external-link">gev.fit</a></span><span class="op">(</span>xdat <span class="op">=</span> <span class="va">dfismev</span><span class="op">$</span><span class="va">SeaLev</span>,</span>
<span>                     ydat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">dfismev</span><span class="op">[</span> , <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"t1num"</span>, <span class="st">"t2num"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                     mul <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fitextRemes2</span> <span class="op">&lt;-</span> <span class="fu">extRemes</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/extRemes/man/fevd.html" class="external-link">fevd</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dfismev</span><span class="op">$</span><span class="va">SeaLev</span>,</span>
<span>                               data <span class="op">=</span> <span class="va">dfismev</span>,</span>
<span>                               type <span class="op">=</span> <span class="st">"GEV"</span>,</span>
<span>                               location.fun <span class="op">=</span> <span class="op">~</span><span class="va">t1num</span> <span class="op">+</span> <span class="va">t2num</span><span class="op">)</span> </span></code></pre></div>
<p>The estimated coefficients and maximised log-likelihoods are as
follows.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="st">"NSGEV"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fitTVGEV2</span><span class="op">)</span>,</span>
<span>      <span class="st">"ismev"</span> <span class="op">=</span> <span class="va">fitismev2</span><span class="op">$</span><span class="va">mle</span>,</span>
<span>      <span class="st">"extRemes"</span> <span class="op">=</span> <span class="va">fitextRemes2</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">par</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##              mu_0     mu_t1        mu_t2  sigma_0        xi_0</span></span>
<span><span class="co">## NSGEV    98.23632 0.4398647  0.002236958 14.62472 -0.02896788</span></span>
<span><span class="co">## ismev    96.38501 0.6325000 -0.001340599 14.56492 -0.02547159</span></span>
<span><span class="co">## extRemes 96.37645 0.6330981 -0.001347965 14.56132 -0.02545380</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NSGEV"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">fitTVGEV2</span><span class="op">)</span>,</span>
<span>  <span class="st">"ismev"</span> <span class="op">=</span> <span class="op">-</span><span class="va">fitismev2</span><span class="op">$</span><span class="va">nllh</span>,</span>
<span>   <span class="st">"extRemes"</span> <span class="op">=</span> <span class="op">-</span><span class="va">fitextRemes2</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">value</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     NSGEV     ismev  extRemes </span></span>
<span><span class="co">## -216.1088 -216.0555 -216.0555</span></span></code></pre>
<p>So, compared to the two other packages, <code><a href="../reference/TVGEV.html">NSGEV::TVGEV</a></code>
returns different estimated coefficients and a smaller maximised
log-likelihood, indicating a problem in the maximisation. Since the
scaling of the trend variable is often a concern, we try a change in the
time origin.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fitTVGEV2b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TVGEV.html">TVGEV</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span>,</span>
<span>                    response <span class="op">=</span> <span class="st">"SeaLevel"</span>, date <span class="op">=</span> <span class="st">"date"</span>,</span>
<span>                    design <span class="op">=</span> <span class="fu"><a href="../reference/polynomX.html">polynomX</a></span><span class="op">(</span>date <span class="op">=</span> <span class="va">date</span>,</span>
<span>                        degree <span class="op">=</span> <span class="fl">2</span>, origin <span class="op">=</span> <span class="st">"1950-01-01"</span><span class="op">)</span>,</span>
<span>                    estim <span class="op">=</span> <span class="va">estim</span>,</span>
<span>                    trace <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                    loc <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">t1</span> <span class="op">+</span> <span class="va">t2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="st">"NSGEV"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fitTVGEV2b</span><span class="op">)</span>,</span>
<span>      <span class="st">"ismev"</span> <span class="op">=</span> <span class="va">fitismev2</span><span class="op">$</span><span class="va">mle</span>,</span>
<span>      <span class="st">"extRemes"</span> <span class="op">=</span> <span class="va">fitextRemes2</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">par</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##               mu_0     mu_t1        mu_t2  sigma_0        xi_0</span></span>
<span><span class="co">## NSGEV    108.50613 0.5793764 -0.001374096 14.55759 -0.02535797</span></span>
<span><span class="co">## ismev     96.38501 0.6325000 -0.001340599 14.56492 -0.02547159</span></span>
<span><span class="co">## extRemes  96.37645 0.6330981 -0.001347965 14.56132 -0.02545380</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NSGEV"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">fitTVGEV2b</span><span class="op">)</span>,</span>
<span>  <span class="st">"ismev"</span> <span class="op">=</span> <span class="op">-</span><span class="va">fitismev2</span><span class="op">$</span><span class="va">nllh</span>,</span>
<span>  <span class="st">"extRemes"</span> <span class="op">=</span> <span class="op">-</span><span class="va">fitextRemes2</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">value</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     NSGEV     ismev  extRemes </span></span>
<span><span class="co">## -216.0554 -216.0555 -216.0555</span></span></code></pre>
<p>The log-likelihood maximised with <code><a href="../reference/TVGEV.html">NSGEV::TVGEV</a></code> is now
identical to that of the other two packages so a simple change of origin
solved the problem. The resulting model in the <code>TVGEV</code> object
is simply a re-parameterisation of the former, and the comparison with
the other packages needs some care because the trends for the location
parameter are no longer identical. The new parameterisation facilitates
the maximisation. To complete the comparison we can use 1950 as an
origin for all models.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfismevb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">within</a></span><span class="op">(</span><span class="va">df</span>, <span class="op">{</span><span class="va">t1num</span> <span class="op">&lt;-</span> <span class="va">Year</span> <span class="op">-</span> <span class="fl">1950</span>; <span class="va">t2num</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">Year</span> <span class="op">-</span> <span class="fl">1950</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">}</span><span class="op">)</span></span>
<span><span class="va">fitismev2b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ismev/man/gev.fit.html" class="external-link">gev.fit</a></span><span class="op">(</span>xdat <span class="op">=</span> <span class="va">dfismevb</span><span class="op">$</span><span class="va">SeaLev</span>,</span>
<span>                      ydat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">dfismevb</span><span class="op">[</span> , <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"t1num"</span>, <span class="st">"t2num"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                      mul <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fitextRemes2b</span> <span class="op">&lt;-</span> <span class="fu">extRemes</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/extRemes/man/fevd.html" class="external-link">fevd</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dfismevb</span><span class="op">$</span><span class="va">SeaLev</span>,</span>
<span>                                data <span class="op">=</span> <span class="va">dfismevb</span>,</span>
<span>                                type <span class="op">=</span> <span class="st">"GEV"</span>,</span>
<span>                                location.fun <span class="op">=</span> <span class="op">~</span><span class="va">t1num</span> <span class="op">+</span> <span class="va">t2num</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="st">"NSGEV"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fitTVGEV2b</span><span class="op">)</span>,</span>
<span>      <span class="st">"ismev"</span> <span class="op">=</span> <span class="va">fitismev2b</span><span class="op">$</span><span class="va">mle</span>,</span>
<span>      <span class="st">"extRemes"</span> <span class="op">=</span> <span class="va">fitextRemes2b</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">par</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##              mu_0     mu_t1        mu_t2  sigma_0        xi_0</span></span>
<span><span class="co">## NSGEV    108.5061 0.5793764 -0.001374096 14.55759 -0.02535797</span></span>
<span><span class="co">## ismev    108.5073 0.5798072 -0.001392904 14.55171 -0.02536854</span></span>
<span><span class="co">## extRemes 108.5062 0.5791653 -0.001358444 14.56185 -0.02550671</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NSGEV"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">fitTVGEV2b</span><span class="op">)</span>,</span>
<span>  <span class="st">"ismev"</span> <span class="op">=</span> <span class="op">-</span><span class="va">fitismev2b</span><span class="op">$</span><span class="va">nllh</span>,</span>
<span>  <span class="st">"extRemes"</span> <span class="op">=</span> <span class="op">-</span><span class="va">fitextRemes2b</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">value</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     NSGEV     ismev  extRemes </span></span>
<span><span class="co">## -216.0554 -216.0555 -216.0555</span></span></code></pre>
<p>We now can proceed to the likelihood ratio test.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">fitTVGEV1</span>, <span class="va">fitTVGEV2b</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Analysis of Deviance Table</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##            df deviance        W Pr(&gt;W)</span></span>
<span><span class="co">## fitTVGEV1   4   432.13                </span></span>
<span><span class="co">## fitTVGEV2b  5   432.11 0.014213 0.9051</span></span></code></pre>
<p>The test tells that adding a quadratic trend term does not improve
the model.</p>
</div>
<div class="section level3">
<h3 id="findings">Findings<a class="anchor" aria-label="anchor" href="#findings"></a>
</h3>
<p>With this example it appears that in <code><a href="../reference/TVGEV.html">NSGEV::TVGEV</a></code> the
maximisation of log-likelihood can fail to find the best value, still
giving an indication of convergence. Here the problem is due to the
order of magnitude of one covariate, namely the quadratic term in the
polynomial basis. It was fixed by simply changing the origin of
time.</p>
<p>With the current implementation of <strong>NSGEV</strong> when
formulas involving several basis covariates are used, we recommend to
fit models with increasing complexity, and check that the log-likelihood
increases when adding a new covariate.</p>
<p>Several solutions can be to improve the code of
<code><a href="../reference/TVGEV.html">NSGEV::TVGEV</a></code> in future versions.</p>
<ul>
<li><p>Allow the user to give initial values for the
parameters.</p></li>
<li><p>Try a “multistart” optimisation with randomly selected initial
values.</p></li>
<li><p>Scale the design matrix <span class="math inline">\(\mathbf{X}\)</span> by subtracting its mean to
each column, and by dividing each column by its standard deviation.
Although this is a quite simple application of the <code>scale</code>
method for the <code>"matrix"</code>class, the estimated coefficients
should then be translated back in the original scale, which can be quite
tedious to implement.</p></li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Yves Deville.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
